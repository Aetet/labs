                            ГЛАВА 21.
                 ИСПОЛЬЗУЕМ ГЕНЕРАТОРЫ ПРИЛОЖЕНИЙ

    Генераторы приложений создают специальные файлы - хранимые описания
отчетов, экранов, меню, сокращая рутинную работу программиста. Размещение
их элементов выполняется на планшете - вспомогательном окне, где
строится шаблон. Отчеты, выводимые на дисплей по такому шаблону, можно
наблюдать также в ходе проектирования (для обратной связи). Ваша задача
- быстро освоить генератор отчетов, поскольку приемы работы с
генераторами одни и те же. В этом вам поможет знание элементов
интерфейса (гл. 15, 20), понимание структуры BROWSE- и SELECT-таблиц.
    Другая задача - научиться использовать диспетчер проектов.

    21.1. Знакомимся с начальными этапами построения отчетов.
                           Планшет

     Отчет является формой, имеющей много общего с SELECT- и
BROWSE-таблицами, но предназначенной для вывода на принтер автономно
или в составе более сложного документа. Отсюда вытекает детализация
оформления (головка и подвал отчета, рамки, пояснительные тексты,
оформление страниц и т.п.), обеспечение получения сводных характеристик
(суммы, средние, экстремумы и т.п.).
     Из двух вариантов расположения: поля БД - колонки отчета, поля
БД - строки отчета, выберем первый. "Поворот координат" при переходе
ко 2 варианту мало что изменяет в приемах работы. Генератор создает
форму отчета (будем называть ее шаблоном) - два файла с расширениями
имен .FRX и .FRT, например Prim.FRX, Prim.FRT. Отчет не обязательно
имеет образ таблицы. Изучим сначала построение простых отчетов-таблиц.
     Определение содержания. Поля БД нужны для прямого вывода в отчет
или получения на их основе характеристик. Разработка форм отчетов
может идти параллельно с созданием информационной базы. Нужно лишь
определить структуры БД (создать пустые БД) - источник данных о
полях БД. Чтобы наблюдать форму отчета в ходе ее создания (изменения),
вместо фактических БД можно использовать БД-макеты такой же структуры
с искусственными значениями полей (некоторые поля можно оставить
пустыми).
     БД и макеты БД, используемые в отчете, должны быть открыты в
разных областях. Если это не сделано заранее, можно из планшета перейти
в окно команд (клавиши Ctrl+F2) для выполнения USE (доступны и иные
команды). Можно открыть БД и через системное меню. Порядок отбора
полей одной или разных БД (в особом окне) определит расположение
колонок, которое несложно изменить. При использовании не одной БД
может понадобиться уточнение имен алиасами.
     Наравне с полями можно выводить вычисляемые поля (см. п. 18.4),
выражения которых надо задать. Если нужно, в шаблоне задают выражения
и для сводных характеристик (итоговые строки).
    Планирование размещения. Допустим, выбраны поля Famil, Dtr, Pol,
Fak, Stipa базы данных Student. Итог отбора полей отображается в шаблоне:
-----------------------------------------------------------------
PgHead│  Famil             Dtr     Pol      Fak      Stipa
 . . .│
PgHead│
Detail│  famil             dtr     pol      fak      stipa
PgFoot│
 . . .│
PgFoot│ DATE()
-----------------------------------------------------------------
    Здесь не показана головка планшета, а троеточия означают
возможность нескольких строк типа PgHead или PgFoot. Типы строк:
 PgHead - верхний колонтитул страницы, в нем в качестве названий
колонок отобразились имена полей (названия колонок можно заменять);
 Detail - содержание колонок (выбранные поля);
 PgFoot - нижний колонтитул ("подвал") страницы.
    При детализации отчета в шаблоне появятся строки иных типов
(иных назначений). Надписи (заголовки колонок и т.п.), имена полей,
иные выражения, рамки - объекты следующих манипуляций на планшете:
 а) выделение (выбор) объекта - наводят курсор на объект и нажимают
Space или кнопку мыши; цвет выделения - красный; выбор объекта
отменяет предыдущий выбор. Если вообще надо отменить выбор, выводят
курсор в свободную позицию и нажимают Space, Enter или кнопку мыши;
 б) передача выделенного объекта в "карман" и удаление его с
планшета - нажимают Ctrl+X; клавиши  Del, Backspace удаляют
одиночный объект, даже если он не выделен;
 в) перенос выделенного объекта - нажимают Ctrl+X, переводят
курсор в новую позицию и нажимают Ctrl+V (передача из "кармана");
 г) копирование выделенного объекта отличается от переноса лишь
тем, что вместо Ctrl+X нажимают Ctrl+C;
 д) перемещение выделенного объекта выполняют или клавишами
управления курсором (конечное положение обозначают нажатием
Space или Enter), или мышью, удерживая кнопку нажатой;
 е) изменение размера объекта, например рамки, - наводят курсор
и активируют объект клавишами Ctrl + Space (Ctrl + мышь): объект
начинает мерцать; клавишами управления курсором изменяют размер
и нажимают Enter или Space; если размер изменяют мышью, последнее
не требуется;
 ж) модификация объекта - наводят курсор и нажимают Enter или
дважды кнопку мыши для появления диалогового окна модификации;
 з) выбор множества объектов - выделяют один и, удерживая Shift,
перемещаются к другому, третьему и т.д., нажимая Space на каждом
из них; если перемещение выполняют мышью, то вместо Space нажимают
кнопку мыши;
 и) удаление строки в шаблоне отчета - нажимают Ctrl+O;
 к) вставка строки в шаблон отчета - нажимают Ctrl+N; типом новой
строки будет тип строки, в которой находился курсор.
    Для выполнения первого задания - создания отчета Prim вам нужно
 - открыть имеющуюся у вас БД, желательно с полями разных типов;
 - вызвать генератор отчетов командой CREATE REPORT Prim или путем
выбора пункта File/New главного меню (в списке типов файлов -
выбрать Report). На экране возникнет планшет, а в главном меню -
пункт Report (самый правый). Вызовите подменю Report и в нем
выберите пункт Quick Report. В появившемся окне
     --------------------------------------------------
        Quick Report:
        (.) Column Layout           ---------------
        ( ) Form Layout              Field1 Field2
        [X] Titles                   xxxxxx xxxxxx
        [ ] Fields ...               xxxxxx xxxxxx
        [ ] Add Alias               ---------------
           << OK >>                   < Cancel >
     --------------------------------------------------
включите клавишей Enter кнопку Fields ..., не меняя ничего более.
Появляется очередное окно, показанное ниже схематично.  В нем
        Database Fields             Selected Fields
     --------------------              ----------------
      AAA                 < Move-> >    BBB
      BBB                               CCC
      CCC                 <  All-> >    EEE
      DDD
      EEE                 < Remove >
      FFF
     -------------------- <Remove ALL> ----------------
          Database                         << OK >>
     --------------------
       <Имя базы данных>                   <Cancel>
     --------------------
наводите маркер на строки левой панели, нажимая Enter в строке
с именем поля БД, необходимого в отчете. Все отобранные имена
появятся в правой панели. После выхода из указанных окон
состояние планшета будет подобно показанному выше. Вам остается
узнать, что контрольный вывод отчета на экран выполняют клавиши
Ctrl+I, а возврат к планшету - кнопка Done. Для сохранения формы
отчета нажимают Ctrl+W (или в подменю File выбирают пункт Save).
   Задание 21.1. Осуществите контрольный вывод отчета Prim для
исходного шаблона и после каждого изменения формы отчета (шаблона):
 а) удалите строку с заголовками колонок;
 б) вставьте строку типа PgHead и наберите русские названия колонок;
если при выводе отчета обнаружите смещения, передвиньте названия;
 в) переставьте колонки полей, воздействуя на объекты строки Detail;
 г) удалите какую-либо колонку;
 д) добавьте колонку для нового выбранного поля, используя Ctrl+F.

           21.2. Занимаемся наглядным оформлением отчета

     Итак, мы быстро получили "черновик" отчета, теперь займемся
улучшением. Обратимся к подменю Report, которое было добавлено в
системное меню:
 ---- Report -------
 Page Layout ...       - переход в диалоговое окно формата страницы
 Page Preview ... ^I   - контрольная выдача отчета на дисплей
 Data Grouping ...     - переход в диалоговое окно группирования записей
 Title/Summary ...     - переход в диалоговое окно "Заголовок/итоги"
 Variables ...         - переход в диалоговое окно создания переменных
 Box              ^B   - создание линий или рамок
 Field ...        ^F   - переход в диалоговое окно задания выражений
 Text             ^T   - установка режима ввода текста в шаблон
 Add Line         ^N   - добавление строки в шаблон
 Remove Line      ^O   - удаление строки шаблона, указанной курсором
 Bring to Front   ^G   - добавление выбранного поля в начало списка
 Send to Back     ^J   - добавление выбранного поля в конец списка
 Center                - центрирование объекта в строке
 Group                 - объявление группы выделенных объектов
 Ungroup               - отмена группирования объектов
 Quick Report ...      - вызов меню создания "быстрого" отчета
--------------------
    Объявление группы объектов означает, что всегда при выделении
одного из них будут автоматически выделяться и прочие. Применение
действий ^I, ^N, ^O и пункта Quick Report рассматривалось в п. 21.1.
Выбирая 1-й пункт подменю, можно задать в окне число (length)
строк в странице отчета, число незанятых строк в ее начале (Top) и
конце (Bottom), отступ слева (indent) при выводе на принтер,
ширину. Ширину страницы удобнее задать на планшете, "буксируя"
мышью правую границу - вертикальную полосу. В этом же окне имеются
3 кнопки: <Save>, <Restore>, <Clear>. Доступна <Save>. После ее
выбора становятся доступны две другие. Выбирая <Restore>, вы
сохраните среду формирования шаблона: открытые БД, индексы. Тогда
вам не придется их открывать в следующий раз, когда шаблон снова
будет в работе (улучшение формы отчета, создание новой на ее
основе), и при выдаче отчета. Выбор кнопки <Clear> стирает
подобную информацию, если среду запоминали ранее.
    Титул и "подвал" отчета. При выборе пункта Title/Summary
выдается окно
         Report  Title:
       ---------------------
        [ ] Title Band
        [ ] New Page                    << OK >>
       ---------------------
         Report Summary:
       ---------------------
        [ ] Summary Band
        [ ] New Page                    <Cancel>
       ---------------------
    Включение кнопки Title Band (Summary Band) вызовет появление в
шаблоне одной строки типа Title (типа Summary) сверху (снизу). Если
заголовок (Title) отчета в целом или его "подвал" более объемны,
используйте пункт Add Line (Ctrl+N) для "размножения" соответствующих
строк. В "солидном" отчете можно предусмотреть титульную страницу и
страницу итогов отчета (кнопки New Page). Титул (заголовок отчета)
обычно не использует выражений (одним из исключений является Date()
- текущая дата), а итоги требуют записи выражений в строки Summary,
сопровождаемых, как правило, надписями или пояснениями.
    Построение выражений. При выборе пункта Field... (Ctrl+F)
подменю Report открывается окно с полем ввода выражения - справа от
кнопки <Expr...>:
       Report Expression:
       <Expr... >         Поле ввода текста выражения
       <Format... >       Поле ввода формата          Width:
                       .   .   .
В нем записываем, например, выражение Sum(Stipa), если надо вывести
суммарный стипендиальный фонд, и указываем справа от слова Width
размер поля фонда, после чего выходим из окна, выбирая < OK >.
   Еще до выбора пункта Field... курсор надо выставить в необходимую
 позицию строки Summary, где и появится выражение.
   Оказавшись в шаблоне, переводим курсор в ту позицию строки
Summary, где должен начинаться текст "Стипендиальный фонд", и нажимаем
Ctrl+T, устанавливая режим ввода текста. При этом в головке шаблона
слово Move ("Перемещение") заменится на Text. Набираем данный текст.
    Конструктор выражений. Выражения в строке Detail. Обычно в
документе указывают фамилию и инициалы. Заменим объект Famil:
выделим его в строке Detail и клавишей Del уничтожим его. Далее,
не перемещая курсор, нажмем Ctrl+F и в появившемся окне, в поле
ввода либо напишем выражение, либо внесем его конструктором
выражений, выбрав кнопку <Expr... >. Возникающее на дисплее окно
конструктора содержит 4 скрытых меню (вверху), а также меню
Field Names имен полей, меню Database и меню переменных (Variables):
----------------------------------------------------------------
   ------------    ------------    ------------   -----------
     Math            String          Logical          Date
   ------------    ------------    ------------   -----------
 ---Report <expr>: -------------------------------------------
             < Поле   конструирования   выражения >
 -------------------------------------------------------------
    Field Names:           Database:         Variables:
  ----------------     ---------------     ---------------
   Famil       C            STUDENT         _ALIGNMENT  C
   Imya        C       ---------------      _BOX        L
   Otch        C           <Verify>         _INDENT     N
   Pol         C           << OK >>         _LMARGIN    N
   . . .                   <Cancel>            . . .
  ---------------                          ---------------
 -------------------------------------------------------------
  При построении выражения (Imya - поле имени, Otch - поле отчества)
       Rtrim(Famil) +" "+ Left(Imya,1) +"."+ Left(Otch,1) +"."
из меню String будем извлекать необходимые строковые функции, а из
списка имен - их аргумента Famil, Imya и Otch, добавляя недостающее.
Итак, конструктор предоставляет "строительный материал", заодно
оказывая справочные услуги в виде перечня математических ("Math"),
логических ("Logical"), строковых ("String") функций и функций
обработки дат ("Date"). Поскольку поля могут быть из разных БД,
для переключения на новую БД предусмотрено скрытое меню "Database:".
    В меню Variables представлены системные переменные и переменные,
назначенные программистом, которые могут также участвовать в
выражениях. Для назначения таких переменных выбирают пункт
Variables подменю Report и в появившемся окне записывают имя
переменной и соответствующее выражение.
    Задание 21.2. Произведите описанные выше изменения в шаблоне и
контрольный вывод отчета. Затем преобразуйте колонку "Дата рождения"
в колонку "Год рождения", а для колонки "Пол" подберите выражение,
обеспечивающее вывод слов "Мужчина", "Женщина". Повторите
контрольный вывод.
    Примечание. Запись выражения в планшете может быть автоматически
усечена соразмерно с шириной поля в отчете. Это не опасно.

                  21.3. Структурируем тело отчета.
                        Группирование строк

     Изучим основательнее окно Report expression, вызываемое с помощью
Ctrl+F:
         Report Expression:
         < Expr... > _____________________
         < Format... > ___________________             Width_________
         [ ] Style...            [ ] Suppres...
         [ ] Calculate...        [ ] Stretch Vertically
         [ ] Comment...          [ ] Float as Band Stretches
                       << OK >>          < Cancel>

    Кнопка <Format...> открывает окно форматирования выводимого значения,
хотя формат в виде SAY-шаблона (см. п. 1.13) без кавычек можно
записать и непосредственно в поле справа от кнопки. В окне Format
имеются кнопки ( )Character, ( )Numeric, ( )Date, ( )Logical. При выборе
одной из них появляется окно диалога и в процессе диалога формируется
SAY-шаблон.
    Кнопка Style... используется для выбора стиля шрифта, Suppres -
для подавления вывода повторяющихся данных: она вызывает окно с
кнопками ( )On (подавление) и ( )Off. При выборе (.) кнопки On из
одинаковых значений поля последовательных записей (или значений
выражения) выводится лишь первое, остальные - заменяются пробелами.
Область действия режима подавления можно ограничить страницей отчета.
    Кнопка Stretch Vertically реализует выдачу поля в несколько
строк указанной ширины (Width) - это удобно при выводе Memo-полей.
Если ниже выводится иное поле (указано в следующей строке Detail),
для него включают кнопку Float as Band Stretches во избежание
наложения данных этих полей. Заметим, что все рассматриваемые
установки выполняются для отдельного поля.
    Кнопка Comment обеспечивает комментарий к данному полю при
работе с планшетом (в отчет он не выводится).
    Кнопка Calculate..., открывая окно, позволяет задать
вычисления "по вертикали" в рамках каждой страницы, всего отчета
или группы (см. ниже). Одна из этих областей действия назначается
в скрытом меню Reset. Характер вычисления задают в кнопочном меню
Calculate. Например, для вывода суммы стипендий в конце каждой
страницы надо указать поле Stipa в окне Report Expression, перейти
в окно кнопки Calculate, там выбрать кнопку (.)Sum и пункт
End of Page в меню Reset (итог в конце каждой страницы) и, наконец,
выбрать << OK >>.
    Группирование строк как вариант структурирования. Могут
вырабатываться оценки для подмножеств записей. Для этого БД
должна быть упорядочена (отсортирована, проиндексирована) по
соответствующему критерию, чтобы записи подмножеств образовали
группы. Допустим, в отчете Prim надо вывести суммы стипендиальных
выплат по каждому курсу каждого факультета. Если мы сохранили
среду формирования шаблона, то в начале нового сеанса работы
достаточно дать команду MODIFY REPORT Prim. Нажимая Ctrl+F2,
перейдем в окно команд и выполним команду INDEX ON Fak+Kurs TO Fakurs.
Теперь выбираем пункт Data Grouping подменю Report. Открывается
окно с кнопками <Add> (добавить выражение группирования),
<Change> (изменить), <Delete> (удалить). Доступна кнопка <Add>.
Выбираем ее и открывается окно Group Info:
        < Group...>
        Options:
        [ ] New Page
        [ ] Swap Page Header
        [ ] Swap Page Footer
        [ ] Reprint Header
        [ ] Reset Page Number
       # of rows following header:  0
    Справа от кнопки <Group> набираем выражение Fak+Kurs (оба
поля символьные, иначе выражение было бы сложнее). Для сложных
выражений можно использовать конструктор  выражений. Далее выбираем
опции:
New Page - данные по группе выводить с новой страницы;
Swap Page Header - заголовки страниц замещать заголовком группы;
Swap Page Footer - то же по отношению к "подвалам" группы и страницы;
Reprint Header - заголовок группы выводить на каждой странице, если
итоговые данные группы занимают несколько страниц;
Reset Page Number - в аналогичном случае для каждой группы нумерацию
страниц осуществлять с начала. В конце нижней строки окна можно
указать число пустых строк, которыми заканчивается подвал группы.
  Назначение группирования автоматически вызовет изменения в планшете:
появятся строки синего цвета выше и ниже области Detail:
   ┌-1-fak       <Строка для задания заголовка группы>
   Detail
   Detail
   └-1-fak       <Строка для задания "подвала" группы>
   При необходимости эти строки могут быть размножены так же, как и
другие. В верхней строке разместим элементы "ФАКУЛЬТЕТ: ", Fak,
"КУРС: ", Kurs . При внесении имени поля Kurs увидим лишь "K",
так как длина поля - 1. Теперь, установив курсор в нижнюю строку,
вызовем окно Report Expression, запишем имя поля Stipa, по которому
требуется итог, и используя кнопку Calculate, укажем суммирование.
Вернувшись в планшет, добавим поясняющую надпись, аналогично
надписи в строке Summary (п. 21.2). Рассмотренным образом можно задать
вывод и нескольких итогов в подвале группы.
     Итак, итоговые сведения могут быть выданы в целом по отчету и
по группам или страницам. Пример более глубокого структурирования
документа, непосредственно не реализуемого, рассмотрим в п. 21.4.
     Задание 21.3. Модифицируйте форму отчета, полученную при выполнении
предыдущих заданий: задайте выражение группирования Fak+Kurs,
предусмотрите заголовки и итоги групп, причем не забудьте проиндексировать
БД. Осуществите контрольный вывод отчета.

                  21.4. Выпускаем отчет

    Только теперь нам потребуются реальные данные, а также бумага,
высококачественный принтер: отчет нередко встречают "по одежке".
Если вы сохраняли среду формирования шаблона и работа шла на
реальной БД, не потребуется даже открывать БД. В общем случае
надо открыть БД и, если предусмотрено группирование, индекс,
затем надо дать команду   REPORT FORMAT <Имя шаблона - FRX-файла>.
Имя может быть без расширения. Слово FORMAT можно сократить до FORM.
Если записать команду в виде REPORT ? или REPORT, будет выдан список
FRX-файлов для выбора одного из них.
   Команда имеет следующие опции (кроме FORMAT <Имя шаблона>):
ENVIRONMENT - восстанавливает среду формирования отчета:
открывает БД и индексы, устанавливает связи БД (если они были);
FOR- и WHILE-условие, <Границы> (см. п. 3.3); по умолчанию
областью действия являются все записи активной БД;
HEADING <ВырC> - задает текст, выводимый в дополнительной
строке заголовка каждой страницы;
NOEJECT - подавляет прогон страницы перед выводом отчета: отчет
может быть небольшим и размещаться внутри страницы документа;
NOCONSOLE - отключает выдачу на экран при выводе в файл и на
принтер; NOOPTIMIZE - выключает оптимизацию доступа к записям;
PDSETUP - восстанавливает настройку принтера, сделанную при
описании отчета и определяющую его внешний вид;
PLAIN - подавляет вывод заголовков страниц, игнорируя HEADING;
PREVIEW - выполняет контрольный вывод на экран (как Ctrl+I);
с этой опцией вывод на принтер или в файл не происходит;
TO PRINTER (TO FILE <Имя файла>) - назначает выдачу отчета на
принтер (в файл);
SUMMARY - назначает режим вывода только итоговых сведений.
    Рассмотрим пример использования. Имеем шаблон Prim, но
требуется выдать итоговые данные и по факультетам, и для каждого
курса факультета. В принципе, можно применить команду REPORT
многократно - в цикле, где изменяется значение переменной M.Fak
("факультет"), записав FOR-условие:
              REPORT FORM <Имя>  FOR Fak=M.Fak.
Форма отчета должна предусматривать группирование по курсам и
вывод сведений о них, а итоговые сведения каждой выдачи отчета
окажутся итогами по факультетам.
 Для получения общих итогов потребуется копия шаблона,
в которой мы устраним группирование. Ее мы укажем в отдельной
команде REPORT с опцией SUMMARY. Следует позаботиться и о титуле
"сводного" отчета. Это предоставляется сделать читателю.
    Данные по каждому факультету будут начинаться с новой страницы,
но если мы этого не хотим, указываем опцию NOEJECT.
    Задание 21.4. На искусственных данных опробуйте вариант
выдачи отчета Prim с группами и искусственными подгруппами,
проверив результат путем контрольного вывода на экран.
Опробуйте также опции HEADING, NOEJECT, PLAIN.

           21.5. Используем генератор экранов

     В гл. 18 рассмотрено редактирование данных в таблицах.
После изучения объектов в стиле WINDOWS, работы с планшетом
вы легко освоите создание экранных форм редактирования (экранов).
Для их определения на планшете используется генератор экранов,
формирующий .SCX-файл с образом экрана и .SCT-файл,
запоминающий состояние среды (открытые БД, индексы). После
создания этих файлов можно сгенерировать программу (.SPR-файл),
которая содержит команды, необходимые для использования .SCX- и
SCT-файла. Можно использовать команду CREATE SCREEN или MODIFY SCREEN
с указанием имени "экрана", либо пункт NEW (OPEN) подменю FILE
(с выбором типа файла SCREEN), чтобы вызвать подменю SCREEN:
--Screen-------------
 Screen Layout...     - заключительное форматирование экрана
 Open All
 Snippets         ^S
---------------------    Ниже идут пункты создания объектов
 Box              ^B  - изображение линий и прямоугольников
 Field...         ^F  - создание|редактирование полей экрана
 Text             ^T  - создание|редактирование текстов
 Push Button      ^H  - создание текстовых кнопок
 Radio Button     ^N  - создание селективных кнопок
 Check Box...     ^K  - создание кнопок-переключателей
 Popup...         ^O  - создание скрытых меню
 List...          ^L  - создание меню-списков
 Inv.Button...    ^I  - создание невидимых кнопок
---------------------  Ниже идут пункты, требующие выделения объекта
 Bring to Front   ^G  - прямой порядок обхода выделенных полей
 Send to Back     ^J  - обратный порядок обхода выделенных полей
 Center               - центрирование поля на экране или в окне
 Reorder Fields       - перенумерация по порядку выделения полей
 Color...             - окраска выделенных объектов
 Group (Boxes)        - объявление группы выделенных объектов
 Ungroup              - отмена группирования объектов
---------------------
 Quick Screen...      - вызов меню создания "быстрого" экрана
---------------------






    Вычисляемые поля. Задание вычисляемых полей производят в окне
Field, вызываемом клавишами Ctrl+F. Например, для замены в шаблоне
поля famil вычисляемым полем  Rtrim(Famil) + " " + Left(Imya,1) +
"." + Left(Otch,1) + "." в окне Field надо нажать кнопку  ( ) Say
и затем справа от возникшей кнопки < Say ...> набрать это выражение.
В результате формируется команда @ <Y,X> SAY ..., причем координаты
<Y,X> определяются положением курсора в момент вызова окна Field.
    Для команд @ ... SAY  не существует иного способа обновления
 вывода, кроме повторного их выполнения. Запись этих команд
 дублируется в функции, на которую ссылается опция SHOW команды
 READ. Всякий раз при выполнении команды SHOW GETS обновления GET-полей,
 будет "срабатывать" и эта функция.
    От нас требуется лишь указать необходимость обновления вычисляемого
поля при переходе к другой записи - нажать кнопку  [ ] Refresh в окне
Field. Создание вычисляемого поля не исключило из шаблона GET-
объект famil и надпись "Famil". Уничтожим их, когда займемся
перемещениями полей в шаблоне.
    Аналогичным образом создадим вычисляемое поле Year(Dtr) (год
рождения) и поле Iif(Kurs ="6", "ДИПЛОМНИК", ""), поместив его
в 4-ю строку справа. Эти поля также должны обновляться.
    Окончательное размещение объектов. Уничтожать ненужные объекты
(п. 21.1), пока они не перекрыты перемещенными надписями и объектами.
В нашем примере удобен такой порядок: сдвинуть вправо вычисляемое поле
в 1 строке, уничтожить объект famil и надпись "Famil", но добавить
надпись "Фамилия и.о.", а поля Tab, Year(Dtr), Fak  поднять на одну
строку, уничтожая прежние надписи и создавая новые. Аналогична работа
по размещению и оформлению полей Pol и Kurs.
    В 5-й строке мы разместим линию, отделяющую строку с кнопками.
Делается это так: обозначают курсором начало линии на планшете,
нажимают Ctrl+B (пункт Box меню) - возникает маленький прямоугольник.
Клавишей "стрелка вверх" его превращают в черту. Она активирована,
мерцает, поэтому клавишами управления курсором можно ее удлинять
или укорачивать. Нажатие клавиши Space деактивирует линию.
    Порождение кнопок. Теперь курсор переводим в начало следующей
строки и используем пункт Push Button подменю Screen (создание
текстовых кнопок). Возникает окно в левое поле которого вписываем
приглашения кнопок: "Следующий", "Предыдущий", "К номеру ...",
"Начало БД", "Конец БД", "Выход":








По умолчанию они располагаются по горизонтали (кнопка (.) Horizontal)
Задаем справа от кнопки < Choose ...> имя  k  GET-переменной (номер
выбранной кнопки) и нажимаем кнопку [ ]Valid, чтобы задать содержание
функции обработки выбора. Появляется новое окно







где кнопка ( )Expression используется, если указывают выражение,
например, ссылку на уже определенную функцию пользователя. Нам
следует нажать кнопку ( )Procedure  и в прямоугольнике ниже
набрать текст функции обработки выбора: структуру DO CASE,
команды SHOW GETS и RETURN. Заголовок функции формируется
автоматически. При выходе из окон, на планшете наблюдаем
созданные кнопки. Осталось добавить кнопку  [ ] ПЛАТНОЕ,
включаемую, если студент - обучается за плату. Ставим курсор
в начало 4-й строки планшета и используем пункт Check Box подменю.
     Перенумерация объектов. Поля, вычисляемые поля, кнопки
упорядочены в соответствии с номерами, которые в шаблоне показаны
только для полей. При использовании экрана курсор будет перемещаться
с объекта на объект в порядке возрастания номера. После произведенных
в нашем примере изменений эти перемещения будут выглядеть довольно
"хаотическими". Перенумеруем объекты. Для этого надо выделить их
именно в той последовательности, в какой потом они должны выбираться
на экране. Выделяем их, придерживая клавишу Shift при
перемещении курсора или маркера мыши. Когда все они выделены, нажимаем
Gtrl+G (или выбираем пункт Bring to Front подменю Screen) и требуемая
нумерация обеспечена. Нажатие Ctrl+J дало бы обратную последовательность
номеров.
    Генерация .SPR-файла. Теперь можно было бы посмотреть, какой
получился экран, но в подменю Screen нет пункта, подобного пункту
Page Preview подменю Report. Взамен предлагается генерация программы,
обеспечивающей предъявление полученного экрана и работу с ним.
В подменю Program главного меню выбираем пункт Generate, отвечаем
положительно на вопросы о необходимости сохранения образа экрана и
среды (в промежуточных окнах) и после этого наблюдаем окно Generate












где можем пока не обращать внимания на кнопки, кроме <Generate>.
Нажимаем ее и ждем некоторое время, пока не получим сообщения о
завершении генерации. Нажимаем Esc, удаляя шаблон, и в командном
окне выполняем команду  DO Prim.SPR (расширение имени обязательно !).
На дисплее возникает созданный экран. С ним можно работать, но
окончательного "изделия" нет: отсутствует рамка, заголовок и подвал
окна, где можно дать ценные указания пользователю, нет
красочного оформления.
    Вызов экрана для модификации. Вновь обратимся к подменю File,
но выберем пункт Open, а в списке типов файлов - Screen. При выборе
этого типа предъявляется список имеющихся файлов экрана, включая
Prim.SCX. Выбор Prim.SCX влечет выдачу на дисплей ранее построенного
шаблона и появление подменю Screen. Если вас не устраивает расположение,
размеры объектов, комментарии к ним, все это можно изменить, но
закончим сначала общее оформление.
    Задание окна и заключительное оформление шаблона. В подменю Screen
выберем 1-й пункт - Screen Layout, открывающий диалоговое окно















    Две верхние кнопки предоставляют выбор: выводить экран в созданное
для него окно (кнопка ( )Window) или непосредственно на дисплей (кнопка
( )DeskTop). Если выбрано первое, можно с помощью кнопки <Type...>
определить характеристики и тип окна:










   Скрытое меню в верхней части позволяет выбрать один из стандартных
типов - Alert, Dialog, System или собственный тип (User), выбрав
опции из указанных ниже (2 колонки кнопок). Скрытые меню внизу дают
возможность задать цветовую схему как для определяемого окна, так и
для используемых в нем меню. Но вернемся к окну Screen Layout.
   Справа от слов Name, Title, Footer можно задать соответственно
имя окна, заголовок и надпись в его подвале. В рамке  Size  задают
размеры окна: высоту Height и ширину Width. Размеры окна можно
изменить на планшете, передвинув границы. Чтобы их зафиксировать,
надо затем в окне Screen Layout выбрать по очереди кнопки DeskTop
и Window. В рамке Position задают координаты левого верхнего угла
окна (по умолчанию оно центрируется).
    Кнопки [ ]Setup и [ ]Cleanup позволяют задать команды,
которые будут включены соответственно в начало и конец генерируемой
программы. Например, команды в начале могут произвести необходимые
установки SET, очистить экран, а команды в конце - некоторые
заключительные действия, которые не могли быть сделаны в функциях
пользователя. Кнопки, располагающиеся ниже надписи READ Clauses:,
нужны для задания опций команды READ. Например, выбор
кнопки [ ]Valid дает возможность набрать функцию пользователя,
используемую в постусловии команды READ. Кнопки ниже слова
Environment  позволяют сохранить (SAVE, затем RESTORE) среду
формирования экрана или, напротив, исключить (CLEAR) эту информацию.
    Усовершенствование сгенерированной программы. После модификации
экрана и внесения прочих рассмотренных выше изиенений можно повторно
генерировать экранную программу (.SPR-файл). В окне Generate
(см. выше), которое детально не изучалось, имеются кнопки
<Edit> (редактировать - включена по умолчанию), <Add> (добавить),
<Remove> (удалить), <Arrange> (разместить), применяемые к
экранам, указанным в панели слева. Эти возможности используются
при создании многооконного интерфейса. Справа имеются кнопки,
обеспечивающие автоматическое открытие файлов БД (Open Files),
их закрытие (Close Files), определение в программе окна, описанного
в диалоге Screen Layout, его автоматическое уничтожение по
завершении использования (Release Windows) и т.д.
    .SPR-файлы могут быть вызваны для просмотра (изучая их, можно
приобрести полезный опыт) и редактирования. Рассмотрим пример. В
первоначально созданном экране поля БД являются GET-переменными, а
следовательно, могут быть изменены пользователем (например,
случайно). В нашем примере поля Pol, Fak, Kurs не подлежат
изменению, и это можно учесть в .SPR-файле. Не будем заменять
командами @ ... SAY  команды @ ... GET, где указаны поля Pol, Fak,
Kurs (вспомните о проблеме обновления вывода). Просто добавим в
каждую GET-команду опцию WHEN .F., чтобы воспрепятствовать входу
в GET-поле. На обновлении GET-полей это никак не отразится, и мы
по-прежнему будем наблюдать данные для очередного студента при
движении по БД.
    Если мы забыли воспользоваться кнопками [ ]Setup, [ ]Cleanup
(см. выше), можно непосредственно внести команды в начало и конец
.SPR-файла.
    Задание 21.5. Создайте экран, рассмотренный выше, сгенерируйте
.SPR-файл и запустите его на выполнение, затем внесите в шаблон
экрана (в .SCX-файл) изменения и/или добавления и повторите
генерацию с последующим использованием экрана. Внесите какие-либо
изменения в .SPR-файл и проследите, как они повлияли на образ
экрана.

         21.6. Строим реляционные запросы по образцу. RQBE

    RQBE - это интерактивное средство построения SELECT-таблиц (см.
гл.17), создающее также программу (.QPR-файл) вывода таблицы.
.QPR-файл можно, например, использовать в интегрированном интерфейсе
пользователя. Читатель, изучивший команду SELECT на примерах гл.17,
может посчитать RQBE избыточным средством, и это будет близко к
истине: RQBE - средство начинающего пользователя, а не опытного
программиста, который в указанном случае просто запишет команду
SELECT языка SQL. Поэтому ограничимся общим рассмотрением RQBE.
    Диалоговое окно формирования запроса, показанное ниже, можно
вызвать, выбрав пункт File/New системного меню (тип файла - Query)
или выполнив команду CREATE QUERY. При этом в системное меню
добавится подменю Query. Если нет открытых БД, окно запроса
возникнет не сразу, а после того, как в окне Open будет выбрана БД.
Пусть это будет Student.DBF. Автоматически ее поля предъявляются
в поле Output Fields.
  Databases      Output Fields                      Output To
 -----------    ---------------                    -----------
   STUDENT         FAMIL        [X]Selected Fields  BROWSE
                   IMYA         [ ]Order By
 -----------       DTR          [ ]Group By         [ ]Options
  < Add >          POL          [ ]Having           < See SQL >
  <Clear>       ---------------                     < Do Query>

  Field Name ____________Not _____Example_____Up=Lo    Select
                                                      Criteria
                                                      <Insert>
                                                      <Remove>
 ----------------------------------------------------  < Or >
   Для вывода таблицы достаточно нажать кнопку <Do Query>. Будут
выведены все поля всех записей активной БД. Для отбора выводимых
полей, задания условий отбора записей, условий связи БД, принципов
упорядочения и группирования, выражений итогов и вычисляемых полей
вызывают окна диалога, используя соответствующие кнопки. Например,
для отбора выводимых полей, а также для задания вычисляемых полей
нажимают кнопку [ ]Select Fields  и в окне диалога производят отбор
или формирование выражения. Окна для задания упорядочения и
группирования - подобны. Отбор полей в окнах диалога одинаков:
наводят маркер на имя поля в левом списке, нажимают Enter и это
имя появляется в списке справа. Нажав <OK>, возвращаются в окно
запроса.
   Если в таблице нужны поля еще одной БД, нажимают кнопку <Add>
ниже списка БД и в открывшемся окне Select database выбирают
следующую БД. Ее выбор открывает окно RQBE Join Condition для
записи в нем условий связи БД.
    Окно диалога для упорядочения строк таблицы открывают кнопкой
[ ]Order By. В нем для каждого выбранного поля (ключа) задают принцип
упорядочения (по возрастанию, по убыванию). Порядок отбора определяет
старшинство ключей: первый ключ - старший. Окно задания группирования
записей вызывается кнопкой [ ]Group By. Для записи итоговых выражений
открывают окно кнопкой Search for Groups Having.
    Условия отбора записей задаются в самом окне запроса, в поле
Select Criteria (широкий прямоугольник внизу). Скрытое меню в правом
верхнем углу окна запроса дает выбор для вывода таблицы: на дисплей,
принтер, в Курсор или в новую БД. BROWSE означает вывод на дисплей.
   Кнопка <See SQL> дает возможность наблюдать сформированную команду
SELECT. Сохранение .QPR-файла можно выполнить, используя пункт
File/Save системного меню или клавиши Ctrl+W.
     Задание 21.6. Реализуйте с помощью RQBE одно из заданий гл. 17,
желательно с группированием записей, упорядочением строк, вычисляемыми
полями и выводом полей вспомогательной БД.

                21.7. Генерируем меню приложения

      Приложением БД называют функционально завершенную систему
использования БД. Примеры: кадровая система, система учета товаров,
покупателей, заявок, продаж, система для банковских операций и т.п.
    Рассмотренные ранее средства: окна, SELECT- и BROWSE-таблицы,
объекты в стиле WINDOWS, отчеты, экраны, - имеют свою "нишу"
применений и сосуществуют в приложениях. Их общая организация
должна быть удобной и понятной даже пользователю-дилетанту.
    Обычно приложение имеет свое меню, которое при запуске
программы заменяет системное меню FOXPRO - меню _MSYSMENU - или
расширяет его возможности. Ускоренный вариант создания меню
как раз и основывается на _MSYSMENU. При этом можно сохранить,
например выборочно, и сами пункты _MSYSMENU, тем более, что
возможна их руссификация. Созданный образ меню будет занесен в
2 файла с расширением имени .MNX и .MNT.
    Создание меню, как и отчетов, экранов, инициируется с помощью
подменю File (пункт File/New, тип файла - Menu; то же делает
команда CREATE MENU), а завершается выбором пункта Program/Generate
системного меню. Вырабатывается программный файл с расширением имени
.MPR . Вновь обратиться к образу меню для его изменения можно
командой MODIFY MENU <Имя> или через пункт File/Open.
    Одновременно с возникновением планшета в системное меню
добавляется подменю Menu:
            General Options...
            <Имя меню> Options...

Горизонтальное меню всегда носит имя Menu Bar, которое первоначально
и наблюдается во 2-м пункте, имена подменю строятся случайным образом.
Пункт Quick Menu заносит в планшет образ системного меню; его пункты
представлены строками планшета. Пункт Insert Item (Ctrl+I) вставляет
в планшет, в текущую строку, новый пункт меню с временным приглашением
"New Item", а пункт Delete Item (Ctrl+E) - исключает текущую строку
(пункт меню). Строка "New Item" заполняется обычным образом (см. ниже).
    Пункт <Имя меню> Options... открывает диалоговое окно, в котором
построенное случайным образом <Имя меню> (имя подменю Popup) можно
заменить собственным именем подменю - более наглядным. Кроме того,
в поле Procedure можно дать <Команду>, используемую при выборе
пунктов подменю, для которых "индивидуальная" реакция не задана. На ее
основе строится команда  ON SELECTION POPUP <Имя подменю><Команда>.
Чтобы задать общую реакцию для таких пунктов всех подменю POPUP,
нужно сделать то же самое, когда в подменю Menu 2-й пункт имеет вид
"Menu Bar Options..."- сформируется  ON SELECTION POPUP ALL <Команда>.
    Пункт General Options открывает диалоговое окно:







    В нем радио-кнопки позволяют дополнить системное меню пунктами
нового меню справа (Append), вставить их перед (Before) или после
(After) заданного пункта системного меню или полностью заменить его
новым (Replace). По умолчанию задано последнее. Кнопки [ ]Setup,
[ ]Cleanup позволяют задавать команды, включаемые соответственно в
начало и конец генерируемой программы (как при создании экрана).
В окне Procedure можно задать <Команду>, используемую в составе
автоматически формируемой команды ON SELECTION MENU _MSYSMENU <Команда> .
С помощью кнопки [ ]Mark назначают символ пометки выбранных
пунктов меню.
    Создание шаблона меню. Итак, мы выполнили команду CREATE MENU
и, допустим, пока не обращались к системному подменю Menu. В теле
планшета мы наблюдаем следующее (чтобы спровоцировать вывод элементов
1-й строки, в ее графу Prompt внесли букву, например X):

      Prompt               Result           Options      Menu Bar
  --------------------------------------------------      <Try it>
   X                 Submenu <Create  >       [ ]      ----Item----
                                                         <Insert>
                                                         <Delete>

    Скрытое меню справа вверху показывает, что мы работаем над
созданием главного (Menu Bar) меню. Для создания подменю будут
в свое время предъявлены отдельные планшеты. В колонку Prompt можем
заносить приглашения пунктов Menu Bar. Реакция на выбор пункта
- вывод подменю (Submenu), которое мы сможем создать, выбрав
кнопку <Create>. Реакция может быть иной: наведите маркер на
слово Submenu, нажмите Enter - раскроется меню с пунктами
Command (команда), Proc.(процедура), Submenu, Pad Name,  и вы
можете выбрать требуемое. Когда процедура или подменю созданы,
в планшете кнопка <Create  > автоматически заменяется кнопкой
<Edit  >. Пункт Pad Name используют, если в меню включены пункты
системного меню, для того, чтобы дать этим пунктам собственные имена.
    Представим, что приложением является библиотечное дело. Запишем
приглашения "КНИЖНЫЙ ФОНД", "ЧИТАТЕЛИ", "ЗАКАЗЫ,ВЫДАЧИ", "ВЫХОД".
Три первых пункта обозначают подменю. В 1-й строке клавишей "стрелка
вправо" переместимся на кнопку <Create>, нажмем Enter и получим
пустой планшет, где будем строить подменю POPUP с пунктами "ПРОСМОТР",
"ИЗМЕНЕНИЕ", "ОТЧЕТ". В правом верхнем углу планшета будет наблюдаться
имя подменю. Это имя соответствующего приглашения, если оно записано на
"латыни", или искусственное имя, которое, мы уже знаем, можно заменить
более подходящим через подменю Menu. Для подпункта "ПРОСМОТР" можно в
графе Result выбрать "Command", после чего справа записать команду
BROWSE. Если БД не открыта, BROWSE вызывает список БД для выбора.
    Чтобы не затруднять пользователя открытием базы данных, можно
выбрать не "Command", а "Proc.", нажать кнопку <Edit  > справа и в
открывшемся окне записать тело несложной процедуры, сохранив его
клавишами Ctrl+W (заголовок процедуры добавится автоматически).
    Подпункт "ОТЧЕТ" здесь означает вывод стандартного отчета по
состоянию книжного фонда, поэтому в графу Result занесем команду
REPORT FORM (предполагается, что среда формирования отчета
запоминалась). Подпункт "ИЗМЕНЕНИЕ" должен выводить нас в очередное
подменю с пунктами "СПИСАНИЕ" и "ПОПОЛНЕНИЕ", следовательно для него
в графе Result выбираем "Submenu" и нажимаем кнопку <Create>.
    Итак, переходы в планшеты подменю происходят при выборе кнопки
<Create> (<Edit  >), но нам придется и возвращаться - для завершения
меню старших уровней. Это делают, раскрывая список меню в правом верхнем
углу планшета и выбирая имя меню, подлежащего доработке. Например, в
главном меню мы еще не определяли три реакции на выбор приглашений.
    Кнопку <Try it> используют для изучения вида создаваемого меню.
Кнопки <Insert>, <Delete> действуют как пункты Insert Item, Delete
Item (см. выше).
    Нажатие кнопки [ ] в графе Options планшета открывает окно:
                                    Options
              Comment:          ----------------  <<  OK  >>

                                ----------------   < Cancel >
              [ ] Shortcut...            [ ] Mark...
              [ ] Skip For...            [ ] Pad Name...

для задания опций того пункта, в строке приглашения которого была
нажата кнопка. Кнопка [ ]Shortcut используется для назначения
"горячей" клавиши выбора пункта (не буквенной клавиши, ибо "горячую"
букву выделяют, как обычно, символами \< в приглашении; если кнопка
[ ]Shortcut использована, "горячая" буква теряет силу). Кнопкой
[ ]Mark можно задать символ пометки выбора именно этого пункта,
например, "сердечко"; предлагается несколько вариантов. Кнопка [ ]Skip For
используется для записи условия пропуска пункта; открывается окно
конструктора выражений, известное по генератору отчетов. Если вы
намерены анализировать сгенерированную программу, целесообразно дать
собственное (наглядное) наименование Pad-пункту с помощью кнопки
[ ]Pad Name. Когда работа идет в планшете подменю, кнопка имеет вид
[ ]Bar #  и позволяет заменить номер пункта другим.
     Генерация .MPR-файла. Даже если создание шаблона меню не завершено,
вы можете создать .MPR-файл. Для проверки правильности ваших
представлений это рекомендуется сделать после оформления одного-двух
подменю. Выбираете пункт Program/Generate системного меню и отвечаете
положительно на вопрос о сохранении образа меню. При этом появится
окно для задания имени образу меню (.MNX- и .MNT-файлам), если оно
не было задано в команде CREATE MENU. Допустим, это имя PRIM.
Далее появляется окно
      ------Menu code-----------------------------------
         <Output File... >      <Comment Options... >
          D:\MENU\PRIM.MPR
      --------------------------------------------------
                   <Generate>   <Cancel>
в котором можно сразу выбрать <Generate>, если вы согласны с именем
PRIM.MPR (иначе надо выбрать кнопку <Output File... > и дать другое
имя) и отказываетесь увековечить свое имя как автора, записав его в
головке программы (это делают с помощью кнопки <Comment Options... >).
Генерация займет некоторое время, и чтобы вы не скучали, ее создание
будет отображено закрашиванием прямоугольника. Теперь нажимайте Esc и
набирайте в командном окне  DO Prim.MPR (расширение имени обязательно).
Насладившись зрелищем меню и опробовав его, переходите к доработке
командой MODIFY MENU Prim (или выбирайте пункт File/Open, тип файла
Menu, наводите маркер на имя Prim и нажимайте Enter).
    Редактирование .MPR-файла. Используя команду MODIFY FILE <Имя
файла с расширением> или пункт File/Open системного меню, можно
вызвать на редактирование .MPR-файл, например, внести изменения для
превращения меню в "обычное". Созданное меню имеет свойства системного:
оно постоянно доступно, не деактивируется и не уничтожается; команда
DO <Имя .MPR-файла> включает меню, но не создает состояния ожидания.
    Для получения "простого смертного меню" в начало .MPR-файла
добавляют команду DEFINE MENU <Имя> и повсеместно заменяют <Именем>
имя _MSYSMENU. Такое меню активируется, деактивируется, уничтожается.
Используя обновленный .MPR-файл, не забудьте удалить старый .MPX-файл.
    Задание 21.7. Создайте главное меню приложения с пунктами
"ФАЙЛЫ", "БАЗА ДАННЫХ", "ВЫХОД". В подменю "ФАЙЛЫ" используйте
пункты "Копирование","Упаковка","Удаление", в подменю "БАЗА ДАННЫХ"
- пункты "Отчет","Экран","Запрос" (примените ранее созданные формы
отчета, экрана, запроса).

                21.8. Квалифицированно создаем проекты

     Теперь мы имеем главное меню, придающее законченный вид интерфейсу
приложения. Организуем и собственную работу над приложением. Необходимо
знать, что результатами трансляции .PRG-файлов, .SPR-файлов (экраны),
.QPR-файлов (запросы), .MPR-файлов (меню) соответственно являются .FXP-,
.SPX-, .QPX-, .MPX-файлы. .APP- и .EXE-файлы являются продуктами "более
глубокой переработки" (см. ниже).
     В редких случаях разработка сразу приводит к законченному
результату. Модификация, улучшение приложения являются обычными перед
окончательным утверждением. Совершенствование приложения возможно и
в процессе эксплуатации (после приемки). Зачастую при этом изменяются
отдельные компоненты: экраны, таблицы, подменю и т.д. Напомним, что
из одноименных файлов для выполнения сначала разыскивается .EXE-файл,
в его отсутствие - .APP-файл, затем .FXP-( или .SPX-, .QPX-, .MPX-)
файл и в последнюю очередь, если ничего не найдено, текстовый
программный файл. Поэтому, если последний изменен, но файлы -
результаты предшествующей трансляции не уничтожены, эффект изменений
не проявится. Другими словами, при бессистемной работе возможны казусы.
     Чтобы этого не случалось, используйте диспетчер ("менеджер")
проектов уже на ранних стадиях разработки. Диспетчер проектов
 - облегчает доступ к ранее созданным компонентам, причем их могут
использовать многие приложения;
 - может объединить используемые .FXP-, .SPX-, .QPX-, .MPX-файлы в
один .APP-файл (создание приложения); это важно для тиражирования;
 - находя все ссылки, избавляет от необходимости отслеживать
подчиненные файлы, например, файлы функций, используемых в меню;
 - автоматически отслеживает изменения, транслируя заново файлы,
подвергшиеся переработке.
   Информация о проекте приложения хранится в 2 файлах с расширениями
имени .PJX и .PJT. Чтобы их создать, воспользуемся пунктом File/New
системного меню, выбрав тип файла Project, или командой CREATE PROJECT.
Пусть именем проекта будет Prim. Одновременно с открытием планшета в
системном меню возникает подменю Project. Ниже приводится вид планшета
после заполнения именами файлов. В нем указаны ранее созданные файлы Prim.
         ---------------------PRIM.PJX----------------------
           --Name--------------Type----------    < Edit >
             PRIM            . Menu              < Info >
             PRIM              Screen            < Add  >
             PRIM              Report            <Remove>
             PRIM              Squery            <Build >
             STUD              Program
           ----------------------------------
         ---------------------------------------------------
    В планшете головной файл проекта помечен жирной точкой.
Кроме <Add>, используются кнопки  <Edit> - открытие файла для
редактирования; <Info> - информация о составе проекта; <Remove>
- удаление файлов из проекта; <Build> - обновление проекта.
Кнопка Build открывает диалоговое окно










   В нем кнопка ( )Rebuild project  инициирует создание или
обновление проекта, ( )Build Application  создает .APP-файл,
( )Build Executable делает доступными кнопки создания .EXE-файлов:
  ( )Compact - создает "компактный" .EXE-файл, выполняющийся
только в присутствии библиотек FOXPRO;
  ( )Stand-alone - создает автономный ("независимый") .EXE-файл;
  ( )Stand-alone Extended - то же для расширенной версии FOXPRO.
   Кнопка ( )Display Errors выдает на экран ошибки, выявленные при
построении проекта; они заносятся и в специальный .ERR-файл;
( )Rebuild All безусловно транслирует все файлы проекта.
  Примечание. Для создания и последующего использования автономных
.EXE-файлов требуется пакет Distribution Kit.
    Подменю Project, показанное ниже, в основном дублирует функции
рассмотренных кнопок планшета и кнопок окна.
  ---Project----------
   Options...      ^O  - вызов диалогового окна задания опций
   Project Info    ^J  - выдача количественных данных о составе проекта
   Show Errors     ^S  - выдача на дисплей файла ошибок (см. выше)
   Set Main            - объявление головным файла в текущей строке
   Exclude/Include ^C  - запрещение (Exclude) компиляции текущего файла
   Edit            ^E
   File Info...    ^I
   Add             ^A
   Remove          ^V  - пометка текущей строки (файла) к удалению
   Build...        ^B
   Pack                - упаковка .PJX-файла (см. пункт Remove)
  --------------------
    Поясним пункт Exclude/Include. Можно включать в проект некоторые
файлы БД, например Foxuser.DBF (см. п. 18.5). Он включается с атрибутом
"только чтение". Другие БД в большинстве своем не интегрируются в
.APP-файл, но в проекте могут быть - с пометкой "э" ("внешняя БД"),
которая устанавливается с помощью пункта Exclude. При работе с
планшетом доступ к данным этих БД обеспечивает кнопка <Edit>. Снятие
(Incllude) пометки выполняется с помощью того же пункта.
    Итак, для создания проекта и приложения нужно после вызова
планшета
 - поместить головной файл в строку планшета кнопкой <Add>;
 - нажать кнопку <Build> и в окне диалога выбрать ( )Rebuild Project;
автоматически имена всех файлов, на которые есть ссылки, например,
файлы экранов, отчетов, будут занесены в планшет; итогом будет .PJX-файл;
 - кнопкой <Add> можно добавить файлы БД, снабжая пометкой "э";
 - в окне диалога выбрать ( )Build Application, если нужен .APP-файл.
При нвличии пакета Distibution Kit, используя кнопку ( )Build
Executable, можно построить компактный или независимый .EXE-файл.
При создании .EXE- (.APP-)файла одноименный .APP- (.EXE-)файл
уничтожается. Помимо планшета создание проекта, .APP- и .EXE-файлов
реализуют команды BUILD PROJECT, BUILD APP, BUILD EXE, соответственно
(см. приложение  ).
    Примечание. Запуск .APP-файла вне FOXPRO возможен при условии
использования файлов библиотеки поддержки из пакета Distribution
Kit.
    Задание 21.8. Создайте проект и приложение (.APP-файл),
используя ранее созданное главное меню приложения.

                    ЗАКЛЮЧЕНИЕ К 21-Й ГЛАВЕ

     Вы ознакомились с новым стилем создания программных продуктов:
быстрое получение на планшете "черновика" и последующая доработка в
интерактивном режиме. Успешное выполнение заданий данной главы
позволит вам перейти к работе над созданием реальных приложений БД.
Привыкайте вести ее систематически - в виде проекта.
